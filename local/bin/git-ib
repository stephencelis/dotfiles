#!/bin/sh

case $1 in
  -a)
    heads=refs/heads
    remotes=refs/remotes
    shift
    ;;
  -r)
    remotes=refs/remotes
    shift
    ;;
  *)
    heads=refs/heads
    ;;
esac

command=${1:-checkout}
shift

git for-each-ref \
   --sort=-committerdate \
   --format='%(refname:short) (%(committerdate:relative))' \
   $heads $remotes \
   | fzf --reverse --preview 'git log --patch --color {1}...{1}~5' \
   | awk '{print $1}' \
   | xargs git $command $@
